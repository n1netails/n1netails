<nz-layout class="app-layout">
  <nz-sider class="menu-sidebar" nzCollapsible nzCollapsed="true" [nzTrigger]="null">
    <app-sidenav></app-sidenav>
  </nz-sider>

  <nz-layout>
    <nz-header>
      <app-header></app-header>
    </nz-header>

    <nz-content>
      <div class="inner-content">
        <!-- KPI Cards -->
        <nz-row class="kpi-cards" [nzGutter]="8">
          <nz-col [nzSpan]="6">
            <nz-card class="tails-primary-color" nzTitle="Alerts Today" [nzBordered]="false"><b>52</b></nz-card>
          </nz-col>
          <nz-col [nzSpan]="6">
            <nz-card class="tails-primary-color" nzTitle="Resolved" [nzBordered]="false"><b>34</b></nz-card>
          </nz-col>
          <nz-col [nzSpan]="6">
            <nz-card class="tails-primary-color" nzTitle="Not Resolved" [nzBordered]="false"><b>18</b></nz-card>
          </nz-col>
          <nz-col [nzSpan]="6">
            <nz-card class="tails-primary-color" nzTitle="Avg. MTTR" [nzBordered]="false"><b>2h 15m</b></nz-card>
          </nz-col>
        </nz-row>

        <!-- Charts Row 1 -->
        <nz-row [nzGutter]="8" class="mb-6">
          <nz-col [nzSpan]="16">
            <nz-card nzTitle="Tail Alerts (Hourly)" [nzBordered]="false">
              <div style="height: 200px">
                <canvas baseChart [data]="alertsTodayData" [options]="barChartOptions" [type]="'bar'">
                </canvas>
              </div>
            </nz-card>
          </nz-col>
          <nz-col [nzSpan]="8">
            <nz-card nzTitle="Tail Resolution Status" [nzBordered]="false">
              <div style="height: 200px">
                <canvas baseChart [data]="alertStatusData" [options]="doughnutOptions" [type]="'doughnut'">
                </canvas>
              </div>
            </nz-card>
          </nz-col>
        </nz-row>

        <!-- Charts Row 2 -->
        <nz-row [nzGutter]="8">
          <nz-col [nzSpan]="16">
            <nz-card nzTitle="Monthly Alerts (Stacked)" [nzBordered]="false">
              <div style="height: 200px">
                <canvas baseChart [data]="monthlyAlertsData" [options]="stackedBarOptions" [type]="'bar'">
                </canvas>
              </div>

            </nz-card>
          </nz-col>
          <nz-col [nzSpan]="8">
            <nz-card nzTitle="Mean Time To Resolution" [nzBordered]="false">
              <div style="height: 200px">
                <canvas baseChart [data]="mttrLineData" [options]="lineChartOptions" [type]="'line'">
                </canvas>
              </div>
            </nz-card>
          </nz-col>
        </nz-row>

        <nz-row [nzGutter]="8">
          <nz-col [nzSpan]="24">
            <nz-card nzTitle="Active Tails" [nzBordered]="false">
              <nz-list [nzDataSource]="tails" [nzLoading]="loadingTails" [nzRenderItem]="itemTemplate" nzItemLayout="horizontal">
                <ng-template #itemTemplate let-item>
                  <nz-list-item>
                    <nz-list-item-meta
                      nzAvatar="assets/n1netails_icon_transparent.png"
                      [nzDescription]="item.description || 'No description provided.'">
                      <nz-list-item-meta-title>
                        <a (click)="edit(item)">{{ item.title }}</a>
                      </nz-list-item-meta-title>
                    </nz-list-item-meta>
                    <div class="list-item-content">
                      <div><strong>Status:</strong> {{ item.status }}</div>
                      <div><strong>Assigned to:</strong> {{ item.assignedUsername || 'Unassigned' }}</div>
                      <div><strong>Timestamp:</strong> {{ item.timestamp | date:'short' }}</div>
                    </div>
                    <ul nz-list-item-actions>
                      <nz-list-item-action><a (click)="edit(item)">edit</a></nz-list-item-action>
                      <nz-list-item-action><a>more</a></nz-list-item-action> 
                    </ul>
                  </nz-list-item>
                </ng-template>
              </nz-list>
              <nz-pagination
                [nzPageIndex]="currentPage + 1"
                [nzPageSize]="pageSize"
                [nzTotal]="totalElements"
                (nzPageIndexChange)="onPageIndexChange($event)"
                style="text-align: right; margin-top: 20px;">
              </nz-pagination>
            </nz-card>
          </nz-col>
        </nz-row>
      </div>
    </nz-content>

  </nz-layout>
</nz-layout>
