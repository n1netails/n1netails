// Inspired by ChatGPT-like styling
@user-message-bg: #4A4A4F; // Slightly lighter gray for user
@ai-message-bg: #2D2F32;   // Darker gray for AI/system
@message-text-color: #ECECEC;
@sender-text-color: #B0B0B0;

.ai-chat-card {
    margin-top: 8px;
    // Assuming .dark-theme-chat is applied to nz-card for overall dark theme
    // background-color: #1E1E1E; // Example main chat background

    .ant-card-body {
      padding: 0; // Remove card body padding if list items will manage their own
    }
}

.ai-chat-card .chat-card-content {
  background-color: #1E1E20; // Consistent dark background for the content area
  // This ensures the area behind messages and input area is dark.
  // nz-card might have its own background, this specifically targets its content wrapper.

  display: flex;
  flex-direction: column;
  height: 100%; // Make sure this is effective; if card has fixed height, this works.
                 // If card height is dynamic, this content area will also be.
  min-height: 400px; // Retain existing min-height
}

.chat-virtual-scroll-container {
  flex: 1 1 auto;
  min-height: 0;
  height: 100%;      // Add this line
  overflow: hidden;
  display: flex;     // Ensure flex context for children
  flex-direction: column;
}

.chat-virtual-scroll-viewport {
  width: 100% !important;
  height: 100% !important;   // Ensure it fills the container
  min-height: 500px;         // Or your preferred min height
  flex: 1 1 auto;
  border-radius: 8px;
  // background: transparent; // Will be overridden by list item styles if they fill it

  // Styling for nz-list within the viewport
  nz-list {
    padding: 16px; // Padding for the overall list container

    .ant-list-item {
      border-bottom: none !important; // Remove default borders
      padding: 4px 0; // Minimal padding, bubble will handle actual spacing
      display: flex; // Enable flex for aligning the bubble (meta)
      flex-direction: column; // Stack title and description properly if meta itself is not the bubble

      .ant-list-item-meta {
        width: fit-content; // Shrink to content size
        max-width: 80%;    // Max width for a bubble
        padding: 10px 15px;
        border-radius: 18px; // Rounded corners for bubbles
        margin-bottom: 8px;  // Space between bubbles
        color: @message-text-color;

        .ant-list-item-meta-title {
          margin-bottom: 4px;
          p {
            margin-bottom: 0;
            font-size: 0.8em;
            font-weight: 600;
            color: @sender-text-color;
          }
        }
        .ant-list-item-meta-description {
          color: inherit;
          font-size: 0.95em;
          line-height: 1.5;
          // Styles for markdown content within messages
          // Apply to the description container, assuming markdown component renders into it directly
          // or these styles will cascade to p, pre, code generated by markdown.
          overflow-wrap: break-word;
          word-wrap: break-word;
          word-break: break-word; // General safety for non-code text

          // Specifically target pre/code rendered by the markdown component within a message
          // This assumes the markdown component doesn't wrap its output in a way that hides pre/code from this path.
          pre {
            max-width: 100%;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            background-color: rgba(0,0,0,0.2); // Darker background for code blocks in bubbles
            padding: 8px;
            border-radius: 6px;
            margin: 8px 0;
          }
          code:not(pre > code) { // Inline code
            word-break: break-all;
            overflow-wrap: break-word;
            background-color: rgba(0,0,0,0.2);
            padding: 0.1em 0.3em;
            border-radius: 3px;
          }
        }
      }
    }

    // User messages
    .user-message {
      align-items: flex-end; // Align the whole list item (and thus the bubble) to the right
      .ant-list-item-meta {
        background-color: @user-message-bg;
        // For right-aligned bubbles, sometimes specific border radii are used:
        // border-bottom-right-radius: 5px;
      }
    }

    // AI messages
    .ai-message {
      align-items: flex-start; // Align the whole list item (and thus the bubble) to the left
      .ant-list-item-meta {
        background-color: @ai-message-bg;
        // For left-aligned bubbles:
        // border-bottom-left-radius: 5px;
      }
    }
  }
}

.chat-input-area {
  // This area should NOT grow or shrink vertically in the main card layout.
  // Its height is determined by its content (textarea, buttons).
  flex: 0 0 auto; // Equivalent to flex-grow: 0; flex-shrink: 0; flex-basis: auto;
  // Or use `flex: none;` which is another way to write `0 0 auto`.

  // Internal layout (horizontal for desktop, vertical for mobile)
  display: flex;
  align-items: flex-end; // For desktop horizontal alignment
  gap: 0; // Desktop gap, overridden by column gap on mobile if needed
  margin-top: 12px; // This already provides some separation
  padding-top: 12px; // Add padding above the input elements
  border-top: 1px solid rgba(255, 255, 255, 0.1); // Subtle top border for dark themes
  width: 100%;
  background: transparent; // Or match chat panel background if different from card's immediate parent

  // Target the textarea's nz-form-item (the one that's a direct child and not .action-buttons)
  > nz-form-item:not(.action-buttons) {
    flex: 1 1 auto; // Allow it to grow and shrink. Crucial for desktop.
    min-width: 0;   // Allow it to shrink below its intrinsic content size. Also crucial.

    // On mobile, it needs to be full width
    @media (max-width: @screen-sm-max) {
      width: 100%;
      flex-basis: auto; // Reset flex-basis for stacked layout
      // Add padding to the bottom of the textarea's form item on mobile
      // to make space for the character count before the buttons appear below.
      // The nz-textarea-count is usually absolutely positioned at the bottom right.
      // This padding should lift the perceived bottom of the container for the count.
      padding-bottom: 20px; // Adjust this value as needed
    }
  }

  // Target the action buttons' nz-form-item
  > nz-form-item.action-buttons {
    flex-shrink: 0; // Prevent button group from shrinking on desktop
    // Other styles for mobile are below in the media query
  }

  // Ensure textarea itself is always 100% of its parent form item
  textarea[nz-input] { // More specific targeting using the Ant Design directive attribute
    width: 100% !important;
    resize: vertical;
    background-color: #2A2E32; // Darker input background, adjust as needed
    border: 1px solid #404245;    // Subtle border
    border-radius: 8px;           // Rounded corners for the textarea
    color: @message-text-color;   // Use defined text color
    padding: 10px 12px;           // Comfortable padding
    line-height: 1.5;             // Better vertical alignment for text
    min-height: 40px;             // Ensure a decent minimum height for a single row

    &::placeholder {
      color: #707070; // Lighter placeholder text
    }

    &:focus {
      border-color: @primary-color; // Highlight with primary color on focus
      box-shadow: none;             // Remove default browser focus shadow
      background-color: #2D2F33;   // Slightly lighter background on focus
    }
  }

  @media (max-width: @screen-sm-max) {
    flex-direction: column;
    gap: 12px;

    // Styling for the form item containing the action buttons on mobile
    nz-form-item.action-buttons {
      margin-left: 0;
      width: 100%;

      button[nz-button] {
        flex: 1;
      }
    }
  }
}

.chat-textarea { // This class is indeed unused.
  // ... (can be removed if not planned for use)
}

// General styles for .action-buttons (which is a class on nz-form-item)
.action-buttons {
  // Desktop styles are mostly inline + the flex-shrink above.
  // Mobile styles are in the media query (e.g. buttons become flex:1).
  // Common button styling for this context:
  button[nz-button] {
    min-width: auto; // Allow buttons to be more compact
    padding: 0 15px; // Adjust horizontal padding
    height: 40px;    // Match typical input height
    line-height: 40px; // Align text vertically for the new height
    border-radius: 8px; // Consistent border radius

    // Specifics for primary button ("Send to Inari")
    &[nzType='primary'] {
      background-color: @primary-color; // Use defined primary color
      border-color: @primary-color;
      color: #FFFFFF;
      &:hover, &:focus {
        background-color: darken(@primary-color, 5%);
        border-color: darken(@primary-color, 5%);
      }
    }

    // Specifics for default button ("Add Note")
    &[nzType='default'] {
      background-color: #5A5E63; // A lighter, more distinct gray for default button
      border-color: #6A6E73;    // Border to match
      color: #E0E0E0;             // Light text for contrast
      &:hover, &:focus {
        background-color: #6A6E73;
        border-color: #7A7E83;
        color: #F0F0F0;
      }
    }
  }
}
